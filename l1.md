---

# Методическое пособие

## Тема: Базовая защита SSH-сервера и фильтрация трафика в Debian 12 (Bookworm)

---

## Введение

В данной работе вы научитесь минимизировать риски при администрировании серверов, используя два основных инструмента:

* **SSH** — безопасный удалённый доступ;
* **iptables** — встроенный межсетевой экран Linux.

Мы рассмотрим настройку на примере **Debian 12 Bookworm**.

---

## Часть 1. Защита SSH-сервера

### Шаги

1. **Редактирование конфигурации SSH**

   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

   В файле измените/добавьте следующие параметры:

   ```ini
   Port 22222               # используем нестандартный порт (пример)
   PermitRootLogin no       # запрет на вход под root
   PasswordAuthentication no # запрет входа по паролю
   ```

2. **Создание нового пользователя**

   ```bash
   sudo adduser student
   sudo usermod -aG sudo student
   ```

3. **Перезапуск SSH**

   ```bash
   sudo systemctl restart ssh
   ```

4. **Проверка**
   Попробуйте подключиться:

   ```bash
   ssh -p 22222 student@IP_СЕРВЕРА
   ```

---

## Часть 2. Фильтрация трафика с помощью iptables

1. **Разрешаем loopback (локальные соединения):**

   ```bash
   sudo iptables -A INPUT -i lo -j ACCEPT
   ```

2. **Разрешаем уже установленные соединения:**

   ```bash
   sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
   ```

3. **Разрешаем SSH на новом порту:**

   ```bash
   sudo iptables -A INPUT -p tcp --dport 22222 -j ACCEPT
   ```

4. **Запрещаем всё остальное:**

   ```bash
   sudo iptables -P INPUT DROP
   sudo iptables -P FORWARD DROP
   ```

5. **Сохранение правил (Debian 12):**

   ```bash
   sudo apt install iptables-persistent -y
   sudo netfilter-persistent save
   ```

---

## Часть 3. Проверка по методическому пособию

### Задание 1. SSH

Перенести SSH на порт от 10000 до 65535.
Создать нового пользователя с правами sudo.
Полностью отключить root для входа.
Запретить вход по паролю, оставить только ключи.
Проверить подключение по ключу к новому пользователю.

---

### Задание 2. iptables

Разрешить только loopback, установленные соединения и SSH.
Проверить открытые порты через `nmap`.
Сохранить правила iptables и проверить их после перезагрузки.

---

### Задание 3. Fail2ban (дополнительно)

Установить `fail2ban`.

```bash
sudo apt install fail2ban -y
```

Настроить блокировку IP после 3–5 неудачных попыток.
Проверить, что IP блокируется при многократном вводе неверного пароля.

---

### Задание 4. Логирование и анализ

Изучить файл логов:

```bash
sudo less /var/log/auth.log
```

Найти IP-адреса, с которых были попытки входа.
Подсчитать успешные и неуспешные подключения.
Составить краткий отчёт.

---

### Задание 5. Дополнительное

Настроить приветственное сообщение (`/etc/motd`).
Добавить ещё один разрешённый порт в iptables (например, 80 для будущего веб-сервера).
Подготовить список команд, которые вы использовали, и объяснить их назначение.

---

## Итог

* Студенты освоили базовую защиту SSH.
* Настроили межсетевой экран с iptables.
* Научились анализировать логи и применять инструменты защиты (fail2ban).

---

