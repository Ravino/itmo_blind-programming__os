# Практические задания по ОС и системному администрированию

## Общая информация
В этом репозитории собраны задания, которые необходимо выполнить **до зачёта**.  

- Выполнять можно **в любом порядке**: берите то, что интереснее или проще, но все задачи должны быть закрыты.  
- Все результаты — **только в текстовом виде**: конфиги, скрипты, логи (`.txt`).  
  **Скриншоты не принимаются**.  
- Итог работы — **репозиторий с артефактами и документацией** (ваша папка или ветка в этом репо).  

Если задания не выполнены — **допуск к зачёту не будет выдан**.  

---

## Работа в командах
- Допускается объединение в команды до **3 человек**.  
- Командная работа возможна только для заданий: **L1, L2, L4, L5**.  
- Остальные задачи выполняются **индивидуально**.  
- В README каждой команды указывайте состав участников и роли каждого участника.  
- Роли вида techwriter не одобряются, только все технические роли.  
- В каждой роли нужно указывать кто и что делал.  

---

## Структура репозитория
В папке `tasks/` лежат отдельные поддиректории для каждого задания.  
Каждая директория должна содержать:
- скрипты/конфиги, которые вы написали или исправили;
- `analysis.md` или `README.md` с описанием:  
  - что было дано,  
  - что вы сделали,  
  - какие команды запускали,  
  - какие логи/артефакты приложили,  
  - итог (почему теперь работает или что именно найдено).  

---

## Задачи

### L1. Настройка ssh, iptables
- Перенести SSH на нестандартный порт, отключить root и вход по паролю, оставить только вход по ключам через нового пользователя с правами sudo.  
- С помощью iptables разрешить только loopback, установленные соединения и новый SSH-порт, всё остальное — блокировать.  
- Дополнительно — изучить логи (`auth.log`), проверить работу fail2ban и сохранить правила firewall.  

---

### L2. Построение L2-сети и внутреннего DNS
- Соединить несколько узлов в одну L2-сеть с помощью **fastd**, **tinc** или **VXLAN**.  
- Развернуть DNS-сервер (bind9 или dnsmasq) с зоной `dc.local`.  
- Настроить, чтобы новые узлы получали имя вида `nginx01.dc.local`.  
- Проверить доступ по именам (`ping`, `dig`, `host`).  
- Все конфиги и логи сохранить в папке.  

---

### L3. Прокси и балансировка
- Поднять **nginx** в серой сети.  
- Настроить проксирование на два backend-сервера (на разных узлах).  
- Каждый backend должен отдавать разный ответ, чтобы видно было, кто ответил.  
- Проверить round-robin (несколько запросов подряд попадают то на один, то на другой backend).  

---

### L4. Отказоустойчивый кластер ClickHouse
- Два `nginx`-прокси под `keepalived` (VIP-адрес).  
- За ними — кластер ClickHouse **3 шарда × 3 реплики**.  
- ZooKeeper в 3 нодах.  
- Поведение:  
  - если падает один proxy — VIP переезжает на второй;  
  - если падает нода CH — прокси исключает её из апстрима, потом возвращает;  
  - если падает 1 ZK — кластер работает; если 2 — ClickHouse в `readonly`.  
- Весь трафик остаётся в серой сети.  
- Автоматизировать всё через **Ansible** (много ролей).  

---

### L5. Автоматизировать на **Ansible** развёртывание стенда в серой сети.  
- 2 Nginx-прокси с **keepalived** (VIP).  
- 3 узла **ZooKeeper**.  
- Кластер **ClickHouse 3×3** (3 шарда × 3 реплики).  
- VIP переключается при сбое прокси.  
- Nginx балансирует трафик и исключает упавшие ноды.  
- ZooKeeper обеспечивает кворум (1 нода может упасть, при 2 — CH только read-only).  

---

### L6. Дебаг с помощью `strace`
- Нужно научиться:
  - находить ошибки прав (`EACCES`), отсутствующие файлы (`ENOENT`);  
  - различать таймауты (`ETIMEDOUT`) и отказы (`ECONNREFUSED`);  
  - ловить блокировки (fcntl/futex);  
  - измерять задержки (`-T`, `-tt`);  
  - разбираться в ошибках seccomp и AppArmor.  
- Для каждой задачи:  
  - логи `strace` в `logs/`,  
  - разбор в `analysis.md`.  

---

### L7. Тюнинг ядра и GRUB
- Настроить параметры загрузки ядра через `/etc/default/grub`.  
- Проверить, какие параметры реально поддерживаются ядром (через `/proc/cmdline`, `/sys/module/*/parameters/`).  
- Сравнить: рабочие параметры vs устаревшие/неподдерживаемые.  
- Объяснить, зачем нужны параметры типа `noinvpcid`, `intel_idle.max_cstate=0`, `apparmor=0`.  

---

## Приёмка
Чтобы задача считалась выполненной:
1. Все файлы и результаты есть в репозитории.  
2. `README.md` или `analysis.md` объясняет, что было сделано.  
3. Все примеры — в **текстовом виде** (никаких картинок).  
4. Проверяющий может запустить ваши шаги и воспроизвести результат.  

---

## Сроки
Все задания должны быть выполнены и загружены в репозиторий **за неделю до даты зачёта**.  

---

Без выполнения практических заданий — допуска к зачёту не будет.

